# Internationalization (i18n) Guide

The NARA boilerplate includes a comprehensive internationalization system that supports multiple languages with type safety and server-side rendering.

## Features

- ✅ Multiple languages (English, Spanish, French by default)
- ✅ Server-side rendering with language detection
- ✅ URL-based language switching (`/en/about`, `/es/about`)
- ✅ Browser language preference detection
- ✅ Type-safe translation keys with autocomplete
- ✅ Fallback strategies for missing translations
- ✅ Language persistence via cookies
- ✅ React Router v7 integration with optional segments

## Quick Start

### 1. Using Translations in Components

```tsx
import { useTranslation } from '~/lib/i18n';

export function MyComponent() {
  const t = useTranslation();
  
  return (
    <div>
      <h1>{t('landing.title')}</h1>
      <p>{t('common.loading')}</p>
    </div>
  );
}
```

### 2. Language Switching

The language switcher is automatically available in the header. Users can:

- Click the globe icon to change languages
- Navigate to URLs with language prefixes (e.g., `/es/about`)
- Have their preference remembered via cookies

### 3. Adding New Languages

1. Create a new translation file in `app/locales/[lang]/common.json`
2. Add the language to the `SUPPORTED_LANGUAGES` array in `app/lib/i18n/config.ts`
3. Add the language name to `LANGUAGE_NAMES` in the same file

Example for German:

```typescript
// app/lib/i18n/config.ts
export const SUPPORTED_LANGUAGES = ['en', 'es', 'fr', 'de'] as const;

export const LANGUAGE_NAMES: Record<SupportedLanguage, string> = {
  en: 'English',
  es: 'Español', 
  fr: 'Français',
  de: 'Deutsch',
} as const;
```

### 4. Adding New Translation Keys

1. Add the key to all language files in `app/locales/[lang]/common.json`
2. TypeScript will automatically provide type safety and autocomplete

Example:

```json
{
  "navigation": {
    "home": "Home",
    "newPage": "New Page"
  }
}
```

Use in component:

```tsx
{t('navigation.newPage')}
```

## URL Structure

The system supports optional language segments:

- `/` - Default language (English)
- `/en/` - English (same as default)
- `/es/` - Spanish
- `/fr/` - French
- `/en/about` - English about page
- `/es/about` - Spanish about page

## Language Detection Priority

1. **URL language parameter** - `/es/about`
2. **Cookie preference** - Previously selected language
3. **Accept-Language header** - Browser preference
4. **Default language** - English

## Server-Side Rendering

Language detection happens on the server, ensuring:

- SEO-friendly URLs with language prefixes
- No flash of incorrect language content
- Proper `lang` attribute on HTML element

## Type Safety

All translation keys are type-checked:

```tsx
// ✅ Valid - TypeScript knows this key exists
t('common.loading')

// ❌ Invalid - TypeScript will show an error
t('nonexistent.key')
```

## Advanced Usage

### Custom Translation Function

```tsx
import { useI18n } from '~/lib/i18n';

export function MyComponent() {
  const { t, language } = useI18n();
  
  return (
    <div>
      <p>Current language: {language}</p>
      <p>{t('common.loading')}</p>
    </div>
  );
}
```

### Language-Specific Logic

```tsx
import { useLanguage } from '~/lib/i18n';

export function DateComponent({ date }: { date: Date }) {
  const { language } = useLanguage();
  
  const formatter = new Intl.DateTimeFormatter(language, {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  
  return <time>{formatter.format(date)}</time>;
}
```

## File Structure

```text
app/
├── lib/i18n/
│   ├── config.ts          # Language configuration
│   ├── types.ts           # TypeScript types
│   ├── translations.ts    # Translation utilities
│   ├── context.tsx        # React context
│   ├── provider.tsx       # Context provider
│   └── index.ts           # Re-exports
├── locales/
│   ├── en/common.json     # English translations
│   ├── es/common.json     # Spanish translations
│   └── fr/common.json     # French translations
│   language.server.ts     # Language session management
└── components/
    └── language-switcher.tsx # Language switcher UI
```

## Best Practices

1. **Keep keys organized** - Use nested objects to group related translations
2. **Use descriptive keys** - `button.save` instead of `btn1`
3. **Maintain consistency** - Keep the same structure across all language files
4. **Test all languages** - Ensure UI doesn't break with longer translations
5. **Use fallbacks** - The system falls back to English if translations are missing

## Troubleshooting

### Missing Translation Keys

If you see the key name instead of translated text, check:

1. The key exists in the English translation file
2. The key path is correct (use dot notation for nested keys)
3. Run `npm run typecheck` to regenerate types

### Language Not Switching

If language switching isn't working:

1. Check that the language is in `SUPPORTED_LANGUAGES`
2. Verify the translation file exists for that language
3. Check browser console for any errors

### TypeScript Errors

If you get TypeScript errors about missing types:

1. Run `npm run typecheck` to regenerate types
2. Ensure all translation files have the same key structure
3. Restart your TypeScript language server
